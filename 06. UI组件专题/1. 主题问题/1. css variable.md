
# web theme 问题
允许用户变更 web 应用的主题是一个非常常见的需求，可以带来一定程度上用户体验提升。
解决这个问题的基本思路就是抽取一些主题变量，然后通过修改这些变量产生新的 css 规则达到变更主题的目的。
这个过程看起来非常简单，但是实际上里面有两个比较难解决的问题：
1. 基础变量和 computed 变量 （衍生变量） 
2. 预编译还是运行时

## 问题 1: 基础型变量和函数型变量
在我们定义的主题变量里，有很大一部分变量是属于函数型变量，它们天然对其他变量有依赖关系。
例如，一个 button 的 background-color 是一个基础型变量，那么为了保证视觉上的对比度，那么 button 的文本颜色应该是由背景颜色推算出来。
这种关系可以用一个函数表达： `color = func(background-color)`.
在这个例子里，background-color 是基础变量，color 是依赖基础变量的函数型变量。 
我们知道，有很多 css in js 的解决方案，但是 js in css 则基本没听说过。
在原生的 css 中, 仅仅只有很少数且功能有限的函数，如 calc 方法，并且在可预见的未来，这方面也不会有根本性的变化。 
正是因为这个原因，很难单独使用 css variable (也称作 css custom property) 来处理 theme 方案。

为了可以在样式中支持更多的函数功能，我们必须要借助一些预编译工具，（如 less 或 sass），它们提供了很多内置和可自定义函数，让用户可以用丰富的函数来处理样式变量。
对于我们来说，less 或 sass 在未来长时间内仍然是必需的。

## 问题 2: 预编译还是运行时？
关于预编译方案，就是通过我们常见的 less 或者 sass 方法，定义 css 变量. 
这种方法的缺陷，就是在最终编译打包完成后的 css 中，变量不再存在，都是具体的样式值。

antd 的官网上，用户可以修改 primary color，网站的主题色会随之发生变化，这个过程看起来是运行时的，但是实际上它仍然是 less 的预处理方法。
它是利用了 less.js 动态修改 less 变量的特性，这个方法不推荐在生产环境上使用，因为它加载的是 less 文件，然后通过 less.js 对这些文件进行处理.
less.js 的这个特性仅仅只为了教学使用，不应该在实际产品中直接使用这种方法。

[less.js](https://lesscss.org/usage/)
>>
  Using Less.js in the browser is the easiest way to get started and convenient for developing with Less, but in production, when performance and reliability is important, we recommend pre-compiling using Node.js or one of the many third party tools available.




# 预处理如何搭配 css variable 一起使用



## 1. 基础变量

```json
{
    "primary-color": "#fff",
}
```


js 和 css 公用问题




## 2. computed 变量
很多其它类型的主题变量


例如设置一个按钮的 background color, 那么它的文字 color 也应该对应发生变化，













# 核心 API 概览

1. css variable 是定义在一个 selector 下，作用范围会限定到这个 selector 的范围。
通常会把 css variables 定义在 :root 下，整个 document 都可以使用 (不包括 iframe)。
```css
:root {
  --main-bg-color: brown;
}
```
2. 自定义变量大小写敏感
3. 范围和继承
4. 无效值处理：当浏览器遇到无效的 var() 时，会使用继承值或初始值代替。(不会使用其他优先级较低的选择器的样式值)

```js
// 获取一个 Dom 节点上的 CSS 变量
element.style.getPropertyValue("--my-var");

// 获取任意 Dom 节点上的 CSS 变量
getComputedStyle(element).getPropertyValue("--my-var");

// 获取 :root
getComputedStyle(document.documentElement).getPropertyValue("--my-var");

// 修改一个 Dom 节点上的 CSS 变量
element.style.setProperty("--my-var", jsVar + 4);

```



# api
1. https://developer.mozilla.org/zh-CN/docs/Web/CSS/var()
2. https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties


# articles
1. https://blog.logrocket.com/how-to-create-better-themes-with-css-variables-5a3744105c74/
2. https://medium.com/front-end-weekly/dynamic-theme-with-css-variables-f1fed123a07f
3. https://css-tricks.com/css-custom-properties-theming/


